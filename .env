# =========================
# Project Tra cứu & Bán Bill
# Mẫu biến môi trường. Sao chép thành ".env" và chỉnh theo môi trường của bạn.
# =========================
# LƯU Ý BẢO MẬT:
# - KHÔNG commit .env vào kho mã nguồn.
# - Đặt SUPABASE_SERVICE_ROLE, DATABASE_URL, SESSION_SECRET, ADMIN_PASSWORD trong secret store (Netlify, Vercel, GitHub Actions Secrets, hoặc Vault).
# - Nếu keys đã lộ, rotate/revoke ngay lập tức trong dashboard Supabase.
# =========================

# Server
# Cổng mà server sẽ lắng nghe (local dev hoặc container)
PORT=3000

# =========================
# CheckBill Pro (upstream)
# =========================
# Base URL của CheckBill Pro (cổng API dùng để tra cước)
# Ví dụ: https://bill.7ty.vn/api
NEW_API_BASE_URL=https://bill.7ty.vn/api

# Endpoint path (thường /check-electricity)
NEW_API_PATH=/check-electricity

# Thời gian chờ (ms) cho mỗi request tới CheckBill Pro
# Nếu upstream chậm, tăng lên; nhưng không quá lớn cho các luồng bulk
NEW_API_TIMEOUT_MS=30000

# Số lần thử lại khi request thất bại (exponential backoff)
# Lưu ý retry sẽ không chạy cho lỗi 4xx (ngoại trừ 429)
NEW_API_MAX_RETRIES=3

# Số request song song (concurrency) tối đa khi tra cứu hàng loạt
# Giữ sao cho không vượt quá giới hạn của upstream (ví dụ 10 req/s)
NEW_API_CONCURRENCY=6

# Nếu bạn dùng proxy hoặc API key cho CheckBill Pro (không bắt buộc)
# EXTERNAL_API_KEY=
# EXTERNAL_PROXY_URL=

# =========================
# Frontend / CORS
# =========================
# Nếu frontend được host trên domain tĩnh, đặt để chỉ cho phép CORS từ domain đó
FRONTEND_URL=http://localhost:3000

# =========================
# Database (Postgres / Supabase)
# =========================
# Connection string Postgres. Ví dụ Supabase:
# postgres://postgres:YOUR_DB_PASSWORD@db.xxxxx.supabase.co:5432/postgres
# Hoặc nếu dùng local Postgres: postgres://user:pass@localhost:5432/dbname
DATABASE_URL=REPLACE_ME_DATABASE_URL

# Nếu bạn muốn tách user/secret cho ứng dụng (không bắt buộc)
# DB_APP_USER=app_user
# DB_APP_PASSWORD=app_password

# =========================
# Session / Auth
# =========================
# Chuỗi bí mật dùng cho session signing hoặc JWT server-side (ít nhất 32 ký tự ngẫu nhiên)
# Tạo bằng openssl rand -base64 32 hoặc secrets.token_urlsafe(32)
SESSION_SECRET=REPLACE_ME_SESSION_SECRET

# Toggle dùng để bypass auth trong dev (KHÔNG bật trên production)
SKIP_AUTH=false

# =========================
# Supabase (optional)
# Nếu bạn dùng Supabase cho DB + Auth + Storage
# SUPABASE_URL thường dạng: https://<project>.supabase.co
SUPABASE_URL=REPLACE_ME_SUPABASE_URL

# Public anon key (có thể dùng trên client; ít quyền)
SUPABASE_ANON_KEY=REPLACE_ME_SUPABASE_ANON_KEY

# Service role key (quyền cao). Chỉ dùng server-side. KHÔNG bao giờ công khai.
SUPABASE_SERVICE_ROLE=REPLACE_ME_SUPABASE_SERVICE_ROLE

# =========================
# Admin bootstrap (seed)
# ADMIN_PASSWORD chỉ dùng tạm thời khi chạy script seed_admin.js để tạo tài khoản admin.
# - KHÔNG để biến này xuất hiện trong repo.
# - Trên CI/Netlify, đặt ADMIN_PASSWORD trong secret env, chạy script seed và xóa/throttle giá trị nếu cần.
# Ví dụ: ADMIN_PASSWORD=$(openssl rand -base64 32)
ADMIN_PASSWORD=REPLACE_ME_ADMIN_PASSWORD

# =========================
# Netlify / Serverless (optional)
# Nếu deploy functions trên Netlify, cấu hình các biến dưới đây giúp xác định đường dẫn build/functions
NETLIFY_BUILD_DIR=public
NETLIFY_FUNCTIONS_DIST=netlify/functions

# =========================
# Logging / Debug
# =========================
# Mức log: debug | info | warn | error
LOG_LEVEL=debug

# Bật logs chi tiết cho network/requests (dev only)
DEBUG_HTTP=false

# =========================
# Rate limiting / Throttling (tùy chọn)
# =========================
# Số request tối đa cho bulk trong cửa sổ thời gian RATE_LIMIT_WINDOW_MS
RATE_LIMIT_MAX=200
RATE_LIMIT_WINDOW_MS=60000

# =========================
# Export / Storage (tùy chọn)
# =========================
# Nếu bạn muốn lưu file export (Excel) vào Supabase Storage hoặc S3, cấu hình tương ứng:
# SUPABASE_STORAGE_BUCKET=my-exports
# S3_ENDPOINT=https://s3.amazonaws.com
# S3_BUCKET=...
# S3_ACCESS_KEY=...
# S3_SECRET_KEY=...

# =========================
# Email / Notifications (tùy chọn)
# =========================
# SMTP_HOST=smtp.example.com
# SMTP_PORT=587
# SMTP_USER=...
# SMTP_PASS=...
# NOTIFICATION_FROM=notifications@example.com

# =========================
# Security & Operational Hints (not variables)
# =========================
# - Đặt các giá trị bí mật trong Secret Manager của nền tảng (Netlify / Vercel / GitHub Secrets).
# - Kiểm tra trước khi deploy: npm run check-env (nếu bạn đã thêm script).
# - Nếu key bị lộ: rotate Supabase service key và DB credentials ngay lập tức.
# - Thực hiện backup schema và dữ liệu trước khi chạy migration trên production.

# =========================
# Dev helpers (commands / generation hints)
# =========================
# Generate a secure SESSION_SECRET (Linux / macOS / WSL):
#   openssl rand -base64 32
# Generate admin password:
#   openssl rand -base64 32
# Or (Python):
#   python -c "import secrets; print(secrets.token_urlsafe(32))"

# Example to set env in Linux/macOS temporarily:
#   export DATABASE_URL="postgres://postgres:PASS@db.x.supabase.co:5432/postgres"
#   export ADMIN_PASSWORD="$(openssl rand -base64 32)"
#   npm run migrate && npm run seed:admin

# Example to set env in PowerShell (Windows):
#   $env:DATABASE_URL = "postgres://postgres:PASS@db.x.supabase.co:5432/postgres"
#   $env:ADMIN_PASSWORD = [Convert]::ToBase64String((New-Object Byte[] 24 | %{ (Get-Random -Maximum 256) }))

# =========================
# App metadata / mode
# =========================
APP_NAME=project-tra-cuu
APP_ENV=development

# =========================
# Useful notes for CI (GitHub Actions / Netlify)
# - On CI set DATABASE_URL, SUPABASE_SERVICE_ROLE, ADMIN_PASSWORD as secrets.
# - Do not echo secrets to logs.
# - Consider a dedicated DB user with limited privileges for app runtime, separate from migration/maintenance user.
# =========================
